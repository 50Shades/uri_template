<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Uri template7</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.5.3/jquery-1.6.2.min.js' type='text/javascript'></script>
    <script src='./assets/0.5.3/jquery.dataTables.min.js' type='text/javascript'></script>   
    <script src='./assets/0.5.3/fancybox/jquery.fancybox-1.3.1.pack.js' type='text/javascript'></script>   
    <script src='./assets/0.5.3/jquery.timeago.js' type='text/javascript'></script>   
    <script src='./assets/0.5.3/jquery.url.js' type='text/javascript'></script>   
    <script src='./assets/0.5.3/highlight.pack.js' type='text/javascript'></script>  
    <script src='./assets/0.5.3/app.js' type='text/javascript'></script>    
    <link href='./assets/0.5.3/stylesheet.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link href='./assets/0.5.3/highlight.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link href='./assets/0.5.3/fancybox/jquery.fancybox-1.3.1.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link href='./assets/0.5.3/smoothness/jquery-ui-1.8.4.custom.css' media='screen, projection, print' rel='stylesheet' type='text/css'>    
    <link rel="shortcut icon" type="image/png" href="./assets/0.5.3/favicon_green.png" />
    <link rel="icon" type="image/png" href="./assets/0.5.3/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.5.3/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2011-12-03T15:48:14+01:00">2011-12-03T15:48:14+01:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="green">94.81%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         43.7
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>3</b> files in total.
    <b>540</b> relevant lines. 
    <span class="green"><b>512</b> lines covered</span> and
    <span class="red"><b>28</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#9fa8ad920a79b98903cb57c06430e4f7a4b80337" class="src_link" title="lib/uri_template/colon.rb">lib/uri_template/colon.rb</a></td>
        <td class="green strong">96.55 %</td>
        <td>154</td>
        <td>58</td>
        <td>56</td>
        <td>2</td>
        <td>4.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b51222c87eeada8f9c7a5548d3fd2877b85a0b26" class="src_link" title="lib/uri_template/draft7.rb">lib/uri_template/draft7.rb</a></td>
        <td class="green strong">95.57 %</td>
        <td>914</td>
        <td>384</td>
        <td>367</td>
        <td>17</td>
        <td>78.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f8d256d1ef3e0fd588dc69c54499afd0f2cfe206" class="src_link" title="lib/uri_template/utils.rb">lib/uri_template/utils.rb</a></td>
        <td class="green strong">90.82 %</td>
        <td>282</td>
        <td>98</td>
        <td>89</td>
        <td>9</td>
        <td>49.1</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.5.4 
        and simplecov-html v0.5.3<br/>
        using RSpec
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="9fa8ad920a79b98903cb57c06430e4f7a4b80337">
  <div class="header">
    <h3>lib/uri_template/colon.rb</h3>
    <h4><span class="green">96.55 %</span> covered</h4>
    <div>
      <b>58</b> relevant lines. 
      <span class="green"><b>56</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># -*- encoding : utf-8 -*-</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">#    This program is free software: you can redistribute it and/or modify</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">#    it under the terms of the Affero GNU General Public License as published by</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">#    the Free Software Foundation, either version 3 of the License, or</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">#    (at your option) any later version.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">#    This program is distributed in the hope that it will be useful,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">#    but WITHOUT ANY WARRANTY; without even the implied warranty of</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">#    GNU General Public License for more details.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">#    You should have received a copy of the GNU General Public License</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">#    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">#    (c) 2011 by Hannes Georg</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">require 'forwardable'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">require 'uri_template'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">require 'uri_template/utils'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"># A colon based template denotes variables with a colon.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"># This template type is realy basic but having just on template type was a bit weird.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">module URITemplate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">class Colon</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  include URITemplate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  VAR = /(?:\{:([a-z]+)\}|:([a-z]+)(?![a-z]))/u</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  class Token</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">    class Variable &lt; self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">      include URITemplate::Expression</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize(name)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="42">
          <span class="hits">7</span>
          
          <code class="ruby">        @name = name</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="43">
          <span class="hits">7</span>
          
          <code class="ruby">        @variables = [name]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">      def expand(vars)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="47">
          <span class="hits">2</span>
          
          <code class="ruby">        return Utils.escape_url(Utils.object_to_param(vars[@name]))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">      def to_r</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="51">
          <span class="hits">2</span>
          
          <code class="ruby">        return ['([^/]*?)'].join</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">    class Static &lt; self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">      include URITemplate::Literal</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize(str)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="61">
          <span class="hits">15</span>
          
          <code class="ruby">        @string = str</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">      def expand(_)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="65">
          <span class="hits">4</span>
          
          <code class="ruby">        return @string</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">      def to_r</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="69">
          <span class="hits">4</span>
          
          <code class="ruby">        return Regexp.escape(@string)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :pattern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">  # Tries to convert the value into a colon-template.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">  # @example</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">  #   URITemplate::Colon.try_convert('/foo/:bar/').pattern #=&gt; '/foo/:bar/'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  #   URITemplate::Colon.try_convert(URITemplate::Draft7.new('/foo/{bar}/')).pattern #=&gt; '/foo/{:bar}/'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.try_convert(x)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="83">
          <span class="hits">11</span>
          
          <code class="ruby">    if x.kind_of? String</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="84">
          <span class="hits">6</span>
          
          <code class="ruby">      return new(x)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="85">
          <span class="hits">5</span>
          
          <code class="ruby">    elsif x.kind_of? self</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="86">
          
          
          <code class="ruby">      return x</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="87">
          <span class="hits">5</span>
          
          <code class="ruby">    elsif x.kind_of? URITemplate::Draft7 and x.level == 1</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="88">
          <span class="hits">6</span>
          
          <code class="ruby">      return new( x.pattern.gsub(/\{(.*?)\}/u){ &quot;{:#{$1}}&quot; } )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">      return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(pattern)</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="95">
          <span class="hits">31</span>
          
          <code class="ruby">    @pattern = pattern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">  # Extracts variables from an uri.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">  # @param String uri</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  # @return nil,Hash</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">  def extract(uri)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="103">
          <span class="hits">2</span>
          
          <code class="ruby">    md = self.to_r.match(uri)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="104">
          <span class="hits">2</span>
          
          <code class="ruby">    return nil unless md</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">    return Hash[ *self.variables.each_with_index.map{|v,i|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">      [v, Utils.unescape_url(md[i+1])]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">    }.flatten(1) ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">  def type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">    :colon</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">  def to_r</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="115">
          <span class="hits">2</span>
          
          <code class="ruby">    @regexp ||= Regexp.new('\A' + tokens.map(&amp;:to_r).join + '\z', Utils::KCODE_UTF8)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">  def tokens</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="119">
          <span class="hits">10</span>
          
          <code class="ruby">    @tokens ||= tokenize!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">  # Tries to concatenate two templates, as if they were path segments.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">  # Removes double slashes or inserts one if they are missing.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">  # @example</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">  #   tpl = URITemplate::Colon.new('/xy/')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">  #   (tpl / '/z/' ).pattern #=&gt; '/xy/z/'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">  #   (tpl / 'z/' ).pattern #=&gt; '/xy/z/'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">  #   (tpl / ':z' ).pattern #=&gt; '/xy/:z'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">  #   (tpl / ':a' / 'b' ).pattern #=&gt; '/xy/:a/b'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">  def /(o)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="133">
          <span class="hits">9</span>
          
          <code class="ruby">    this, other, this_converted, other_converted = URITemplate.coerce( self, o )</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="134">
          <span class="hits">9</span>
          
          <code class="ruby">    if this_converted</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">      return this / other</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="137">
          <span class="hits">8</span>
          
          <code class="ruby">    return self.class.new( File.join( this.pattern, other.pattern ) )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">  def tokenize!</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="143">
          <span class="hits">9</span>
          
          <code class="ruby">    RegexpEnumerator.new(VAR).each(@pattern).map{|x|</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="144">
          <span class="hits">22</span>
          
          <code class="ruby">      if x.kind_of? String</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="145">
          <span class="hits">15</span>
          
          <code class="ruby">        Token::Static.new(x)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">        # TODO: when rubinius supports ambigious names this could be replaced with x['name'] *sigh*</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="148">
          <span class="hits">7</span>
          
          <code class="ruby">        Token::Variable.new(x[1] || x[2])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">    }.to_a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b51222c87eeada8f9c7a5548d3fd2877b85a0b26">
  <div class="header">
    <h3>lib/uri_template/draft7.rb</h3>
    <h4><span class="green">95.57 %</span> covered</h4>
    <div>
      <b>384</b> relevant lines. 
      <span class="green"><b>367</b> lines covered</span> and
      <span class="red"><b>17</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># -*- encoding : utf-8 -*-</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">#    This program is free software: you can redistribute it and/or modify</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">#    it under the terms of the Affero GNU General Public License as published by</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">#    the Free Software Foundation, either version 3 of the License, or</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">#    (at your option) any later version.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">#    This program is distributed in the hope that it will be useful,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">#    but WITHOUT ANY WARRANTY; without even the implied warranty of</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">#    GNU General Public License for more details.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">#    You should have received a copy of the GNU General Public License</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">#    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">#    (c) 2011 by Hannes Georg</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">require 'strscan'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">require 'set'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">require 'forwardable'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">require 'uri_template'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">require 'uri_template/utils'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"># A uri template which should comply with the uri template spec draft 7 ( http://tools.ietf.org/html/draft-gregorio-uritemplate-07 ).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"># @note</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">#   Most specs and examples refer to this class directly, because they are acutally refering to this specific implementation. If you just want uri templates, you should rather use the methods on {URITemplate} to create templates since they will select an implementation.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">class URITemplate::Draft7</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  include URITemplate</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  extend Forwardable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  # @private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  Utils = URITemplate::Utils</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  # @private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  #                           \/ - unicode ctrl-chars ( \p{Cc} doen't work with rbx</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  LITERAL = /^([^&quot;'%&lt;&gt;\\^`{|}\s\p{Cntrl}]|%\h\h)+/u</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  # @private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  CHARACTER_CLASSES = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    :unreserved =&gt; {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">      :unencoded =&gt; /([^A-Za-z0-9\-\._])/u,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      :class =&gt; '(?:[A-Za-z0-9\-\._]|%\h\h)',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      :class_name =&gt; 'c_u_',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      :grabs_comma =&gt; false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    :unreserved_reserved_pct =&gt; {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      :unencoded =&gt; /([^A-Za-z0-9\-\._:\/?#\[\]@!\$%'\(\)*+,;=]|%(?!\h\h))/u,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      :class =&gt; '(?:[A-Za-z0-9\-\._:\/?#\[\]@!\$%\'\(\)*+,;=]|%\h\h)',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      :class_name =&gt; 'c_urp_',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">      :grabs_comma =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    :varname =&gt; {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">      :class =&gt; '(?:[a-zA-Z_]|%[0-9a-fA-F]{2})(?:[a-zA-Z_\.]|%[0-9a-fA-F]{2})*?',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">      :class_name =&gt; 'c_vn_'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">  # Specifies that no processing should be done upon extraction.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  # @see #extract</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">  NO_PROCESSING = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  # Specifies that the extracted values should be processed.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  # @see #extract</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">  CONVERT_VALUES = [:convert_values]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">  # Specifies that the extracted variable list should be processed.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">  # @see #extract</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">  CONVERT_RESULT = [:convert_result]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">  # Default processing. Means: convert values and the list itself.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  # @see #extract</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">  DEFAULT_PROCESSING = CONVERT_VALUES + CONVERT_RESULT</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">  # @private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">  VAR = Regexp.compile(&lt;&lt;'__REGEXP__'.strip, Utils::KCODE_UTF8)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">((?:[a-zA-Z_]|%[0-9a-fA-F]{2})(?:[a-zA-Z_\.]|%[0-9a-fA-F]{2})*)(\*)?(?::(\d+))?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">__REGEXP__</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">  # @private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">  EXPRESSION = Regexp.compile(&lt;&lt;'__REGEXP__'.strip, Utils::KCODE_UTF8)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">\{([+#\./;?&amp;]?)((?:[a-zA-Z_]|%[0-9a-fA-F]{2})(?:[a-zA-Z_\.]|%[0-9a-fA-F]{2})*\*?(?::\d+)?(?:,(?:[a-zA-Z_]|%[0-9a-fA-F]{2})(?:[a-zA-Z_\.]|%[0-9a-fA-F]{2})*\*?(?::\d+)?)*)\}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">__REGEXP__</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">  # @private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">  URI = Regexp.compile(&lt;&lt;'__REGEXP__'.strip, Utils::KCODE_UTF8)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">\A(([^&quot;'%&lt;&gt;^`{|}\s\p{Cntrl}]|%\h\h)+|\{([+#\./;?&amp;]?)((?:[a-zA-Z_]|%[0-9a-fA-F]{2})(?:[a-zA-Z_\.]|%[0-9a-fA-F]{2})*\*?(?::\d+)?(?:,(?:[a-zA-Z_]|%[0-9a-fA-F]{2})(?:[a-zA-Z_\.]|%[0-9a-fA-F]{2})*\*?(?::\d+)?)*)\})*\z</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">__REGEXP__</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">  SLASH = ?/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">  # @private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">  class Token</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  # @private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">  class Literal &lt; Token</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">    include URITemplate::Literal</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(string)</code>
        </li>
      
        <li class="covered" data-hits="175" data-linenumber="107">
          <span class="hits">175</span>
          
          <code class="ruby">      @string = string</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">    def level</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="111">
          <span class="hits">17</span>
          
          <code class="ruby">      1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">    def arity</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="115">
          
          
          <code class="ruby">      0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">    def to_r_source(*_)</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="119">
          <span class="hits">42</span>
          
          <code class="ruby">      Regexp.escape(@string)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">    def to_s</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="123">
          <span class="hits">25</span>
          
          <code class="ruby">      @string</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">  # @private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">  class Expression &lt; Token</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">    include URITemplate::Expression</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :variables, :max_length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(vars)</code>
        </li>
      
        <li class="covered" data-hits="313" data-linenumber="136">
          <span class="hits">313</span>
          
          <code class="ruby">      @variable_specs = vars</code>
        </li>
      
        <li class="covered" data-hits="313" data-linenumber="137">
          <span class="hits">313</span>
          
          <code class="ruby">      @variables = vars.map(&amp;:first)</code>
        </li>
      
        <li class="covered" data-hits="313" data-linenumber="138">
          <span class="hits">313</span>
          
          <code class="ruby">      @variables.uniq!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">    PREFIX = ''.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">    SEPARATOR = ','.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">    PAIR_CONNECTOR = '='.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">    PAIR_IF_EMPTY = true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">    LIST_CONNECTOR = ','.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">    BASE_LEVEL = 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">    CHARACTER_CLASS = CHARACTER_CLASSES[:unreserved]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">    NAMED = false</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">    OPERATOR = ''</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">    def level</code>
        </li>
      
        <li class="covered" data-hits="62" data-linenumber="154">
          <span class="hits">62</span>
          
          <code class="ruby">      if @variable_specs.none?{|_,expand,ml| expand || (ml &gt; 0) }</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="155">
          <span class="hits">18</span>
          
          <code class="ruby">        if @variable_specs.size == 1</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="156">
          <span class="hits">12</span>
          
          <code class="ruby">          return self.class::BASE_LEVEL</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="158">
          <span class="hits">6</span>
          
          <code class="ruby">          return 3</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="161">
          <span class="hits">9</span>
          
          <code class="ruby">        return 4</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">    def arity</code>
        </li>
      
        <li class="covered" data-hits="240" data-linenumber="166">
          <span class="hits">240</span>
          
          <code class="ruby">      @variable_specs.size</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">    def expand( vars )</code>
        </li>
      
        <li class="covered" data-hits="231" data-linenumber="170">
          <span class="hits">231</span>
          
          <code class="ruby">      result = []</code>
        </li>
      
        <li class="covered" data-hits="231" data-linenumber="171">
          <span class="hits">231</span>
          
          <code class="ruby">      @variable_specs.each{| var, expand , max_length |</code>
        </li>
      
        <li class="covered" data-hits="315" data-linenumber="172">
          <span class="hits">315</span>
          
          <code class="ruby">        unless vars[var].nil?</code>
        </li>
      
        <li class="covered" data-hits="291" data-linenumber="173">
          <span class="hits">291</span>
          
          <code class="ruby">          if vars[var].kind_of? Hash</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="174">
          <span class="hits">28</span>
          
          <code class="ruby">            result.push( *transform_hash(var, vars[var], expand, max_length) )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">          elsif vars[var].kind_of? Array</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="176">
          <span class="hits">52</span>
          
          <code class="ruby">            result.push( *transform_array(var, vars[var], expand, max_length) )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="211" data-linenumber="178">
          <span class="hits">211</span>
          
          <code class="ruby">            if self.class::NAMED</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="179">
          <span class="hits">72</span>
          
          <code class="ruby">              result.push( pair(var, vars[var], max_length) )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="covered" data-hits="139" data-linenumber="181">
          <span class="hits">139</span>
          
          <code class="ruby">              result.push( cut( escape(vars[var]), max_length ) )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="covered" data-hits="231" data-linenumber="186">
          <span class="hits">231</span>
          
          <code class="ruby">      if result.any?</code>
        </li>
      
        <li class="covered" data-hits="221" data-linenumber="187">
          <span class="hits">221</span>
          
          <code class="ruby">        return (self.class::PREFIX + result.join(self.class::SEPARATOR))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="189">
          <span class="hits">10</span>
          
          <code class="ruby">        return ''</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">    def to_s</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="194">
          <span class="hits">20</span>
          
          <code class="ruby">      return '{' + self.class::OPERATOR + @variable_specs.map{|name,expand,max_length| name + (expand ? '*': '') + (max_length &gt; 0 ? (':' + max_length.to_s) : '') }.join(',') + '}'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">    #TODO: certain things after a slurpy variable will never get matched. therefore, it's pointless to add expressions for them</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">    #TODO: variables, which appear twice could be compacted, don't they?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">    def to_r_source</code>
        </li>
      
        <li class="covered" data-hits="127" data-linenumber="200">
          <span class="hits">127</span>
          
          <code class="ruby">      source = []</code>
        </li>
      
        <li class="covered" data-hits="127" data-linenumber="201">
          <span class="hits">127</span>
          
          <code class="ruby">      first = true</code>
        </li>
      
        <li class="covered" data-hits="127" data-linenumber="202">
          <span class="hits">127</span>
          
          <code class="ruby">      vs = @variable_specs.size - 1</code>
        </li>
      
        <li class="covered" data-hits="127" data-linenumber="203">
          <span class="hits">127</span>
          
          <code class="ruby">      i = 0</code>
        </li>
      
        <li class="covered" data-hits="127" data-linenumber="204">
          <span class="hits">127</span>
          
          <code class="ruby">      if self.class::NAMED</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="205">
          <span class="hits">41</span>
          
          <code class="ruby">        @variable_specs.each{| var, expand , max_length |</code>
        </li>
      
        <li class="covered" data-hits="62" data-linenumber="206">
          <span class="hits">62</span>
          
          <code class="ruby">          value = &quot;(?:#{self.class::CHARACTER_CLASS[:class]}|,)#{(max_length &gt; 0)?'{,'+max_length.to_s+'}':'*'}&quot;</code>
        </li>
      
        <li class="covered" data-hits="62" data-linenumber="207">
          <span class="hits">62</span>
          
          <code class="ruby">          if expand</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">            #if self.class::PAIR_IF_EMPTY</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="209">
          <span class="hits">11</span>
          
          <code class="ruby">            pair = &quot;(?:#{CHARACTER_CLASSES[:varname][:class]}#{Regexp.escape(self.class::PAIR_CONNECTOR)})?#{value}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">            </code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="211">
          <span class="hits">11</span>
          
          <code class="ruby">            if first</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="212">
          <span class="hits">10</span>
          
          <code class="ruby">              source &lt;&lt; &quot;((?:#{pair})(?:#{Regexp.escape(self.class::SEPARATOR)}#{pair})*)&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">              source &lt;&lt; &quot;((?:#{Regexp.escape(self.class::SEPARATOR)}#{pair})*)&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="51" data-linenumber="217">
          <span class="hits">51</span>
          
          <code class="ruby">            if self.class::PAIR_IF_EMPTY</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="218">
          <span class="hits">31</span>
          
          <code class="ruby">              pair = &quot;#{Regexp.escape(var)}(#{Regexp.escape(self.class::PAIR_CONNECTOR)}#{value})&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="220">
          <span class="hits">20</span>
          
          <code class="ruby">              pair = &quot;#{Regexp.escape(var)}(#{Regexp.escape(self.class::PAIR_CONNECTOR)}#{value}|)&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">            </code>
        </li>
      
        <li class="covered" data-hits="51" data-linenumber="223">
          <span class="hits">51</span>
          
          <code class="ruby">            if first</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="224">
          <span class="hits">31</span>
          
          <code class="ruby">            source &lt;&lt; &quot;(?:#{pair})&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="226">
          <span class="hits">20</span>
          
          <code class="ruby">              source &lt;&lt; &quot;(?:#{Regexp.escape(self.class::SEPARATOR)}#{pair})?&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="covered" data-hits="62" data-linenumber="230">
          <span class="hits">62</span>
          
          <code class="ruby">          first = false</code>
        </li>
      
        <li class="covered" data-hits="62" data-linenumber="231">
          <span class="hits">62</span>
          
          <code class="ruby">          i = i+1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="234">
          <span class="hits">86</span>
          
          <code class="ruby">        @variable_specs.each{| var, expand , max_length |</code>
        </li>
      
        <li class="covered" data-hits="109" data-linenumber="235">
          <span class="hits">109</span>
          
          <code class="ruby">          last = (vs == i)</code>
        </li>
      
        <li class="covered" data-hits="109" data-linenumber="236">
          <span class="hits">109</span>
          
          <code class="ruby">          if expand</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby">            # could be list or map, too</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="238">
          <span class="hits">16</span>
          
          <code class="ruby">            value = &quot;#{self.class::CHARACTER_CLASS[:class]}#{(max_length &gt; 0)?'{,'+max_length.to_s+'}':'*'}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby">            </code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="240">
          <span class="hits">16</span>
          
          <code class="ruby">            pair = &quot;(?:#{CHARACTER_CLASSES[:varname][:class]}#{Regexp.escape(self.class::PAIR_CONNECTOR)})?#{value}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">            </code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="242">
          <span class="hits">16</span>
          
          <code class="ruby">            value = &quot;#{pair}(?:#{Regexp.escape(self.class::SEPARATOR)}#{pair})*&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">          elsif last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby">            # the last will slurp lists</code>
        </li>
      
        <li class="covered" data-hits="72" data-linenumber="245">
          <span class="hits">72</span>
          
          <code class="ruby">            if self.class::CHARACTER_CLASS[:grabs_comma]</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="246">
          <span class="hits">25</span>
          
          <code class="ruby">              value = &quot;#{self.class::CHARACTER_CLASS[:class]}#{(max_length &gt; 0)?'{,'+max_length.to_s+'}':'*?'}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="248">
          <span class="hits">47</span>
          
          <code class="ruby">              value = &quot;(?:#{self.class::CHARACTER_CLASS[:class]}|,)#{(max_length &gt; 0)?'{,'+max_length.to_s+'}':'*?'}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="251">
          <span class="hits">21</span>
          
          <code class="ruby">            value = &quot;#{self.class::CHARACTER_CLASS[:class]}#{(max_length &gt; 0)?'{,'+max_length.to_s+'}':'*?'}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="109" data-linenumber="253">
          <span class="hits">109</span>
          
          <code class="ruby">          if first</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="254">
          <span class="hits">86</span>
          
          <code class="ruby">            source &lt;&lt; &quot;(#{value})&quot;</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="255">
          <span class="hits">86</span>
          
          <code class="ruby">            first = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="257">
          <span class="hits">23</span>
          
          <code class="ruby">            source &lt;&lt; &quot;(?:#{Regexp.escape(self.class::SEPARATOR)}(#{value}))?&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="109" data-linenumber="259">
          <span class="hits">109</span>
          
          <code class="ruby">          i = i+1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="260">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="127" data-linenumber="262">
          <span class="hits">127</span>
          
          <code class="ruby">      return '(?:' + Regexp.escape(self.class::PREFIX) + source.join + ')?'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="265">
          <span class="hits">1</span>
          
          <code class="ruby">    def extract(position,matched)</code>
        </li>
      
        <li class="covered" data-hits="325" data-linenumber="266">
          <span class="hits">325</span>
          
          <code class="ruby">      name, expand, max_length = @variable_specs[position]</code>
        </li>
      
        <li class="covered" data-hits="325" data-linenumber="267">
          <span class="hits">325</span>
          
          <code class="ruby">      if matched.nil?</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="268">
          <span class="hits">25</span>
          
          <code class="ruby">        return [[ name , matched ]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="269">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="300" data-linenumber="270">
          <span class="hits">300</span>
          
          <code class="ruby">      if expand</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby">        #TODO: do we really need this? - this could be stolen from rack</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="272">
          <span class="hits">47</span>
          
          <code class="ruby">        ex = self.class.hash_extractor(max_length)</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="273">
          <span class="hits">47</span>
          
          <code class="ruby">        rest = matched</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="274">
          <span class="hits">47</span>
          
          <code class="ruby">        splitted = []</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="275">
          <span class="hits">47</span>
          
          <code class="ruby">        found_value = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="276">
          
          
          <code class="ruby">        # 1 = name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="277">
          
          
          <code class="ruby">        # 2 = value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">        # 3 = rest</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="279">
          <span class="hits">47</span>
          
          <code class="ruby">        until rest.size == 0</code>
        </li>
      
        <li class="covered" data-hits="129" data-linenumber="280">
          <span class="hits">129</span>
          
          <code class="ruby">          match = ex.match(rest)</code>
        </li>
      
        <li class="covered" data-hits="129" data-linenumber="281">
          <span class="hits">129</span>
          
          <code class="ruby">          if match.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="282">
          
          
          <code class="ruby">            raise &quot;Couldn't match #{rest.inspect} againts the hash extractor. This is definitly a Bug. Please report this ASAP!&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="129" data-linenumber="284">
          <span class="hits">129</span>
          
          <code class="ruby">          if match.post_match.size == 0</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="285">
          <span class="hits">47</span>
          
          <code class="ruby">            rest = match[3].to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="82" data-linenumber="287">
          <span class="hits">82</span>
          
          <code class="ruby">            rest = ''</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="129" data-linenumber="289">
          <span class="hits">129</span>
          
          <code class="ruby">          if match[1]</code>
        </li>
      
        <li class="covered" data-hits="62" data-linenumber="290">
          <span class="hits">62</span>
          
          <code class="ruby">            found_value = true</code>
        </li>
      
        <li class="covered" data-hits="62" data-linenumber="291">
          <span class="hits">62</span>
          
          <code class="ruby">            splitted &lt;&lt; [ match[1][0..-2], decode(match[2] + rest , false) ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="293">
          <span class="hits">67</span>
          
          <code class="ruby">            splitted &lt;&lt; [ match[2] + rest, nil ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="129" data-linenumber="295">
          <span class="hits">129</span>
          
          <code class="ruby">          rest = match.post_match</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="296">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="297">
          <span class="hits">47</span>
          
          <code class="ruby">        if !found_value</code>
        </li>
      
        <li class="covered" data-hits="89" data-linenumber="298">
          <span class="hits">89</span>
          
          <code class="ruby">          return [ [ name, splitted.map{|n,v| decode(n , false) } ] ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="299">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="300">
          <span class="hits">24</span>
          
          <code class="ruby">          return [ [ name, splitted ] ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">      elsif self.class::NAMED</code>
        </li>
      
        <li class="covered" data-hits="90" data-linenumber="303">
          <span class="hits">90</span>
          
          <code class="ruby">        return [ [ name, decode( matched[1..-1] ) ] ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="305">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="163" data-linenumber="306">
          <span class="hits">163</span>
          
          <code class="ruby">      return [ [ name,  decode( matched ) ] ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="307">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby">     </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="310">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">    module ClassMethods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">      def hash_extractor(max_length)</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="314">
          <span class="hits">47</span>
          
          <code class="ruby">        @hash_extractors ||= {}</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="315">
          <span class="hits">47</span>
          
          <code class="ruby">        @hash_extractors[max_length] ||= begin</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="316">
          <span class="hits">8</span>
          
          <code class="ruby">          value = &quot;#{self::CHARACTER_CLASS[:class]}#{(max_length &gt; 0)?'{,'+max_length.to_s+'}':'*?'}&quot;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="317">
          <span class="hits">8</span>
          
          <code class="ruby">          pair = &quot;(#{CHARACTER_CLASSES[:varname][:class]}#{Regexp.escape(self::PAIR_CONNECTOR)})?(#{value})&quot;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="318">
          <span class="hits">8</span>
          
          <code class="ruby">          source = &quot;\\A#{Regexp.escape(self::SEPARATOR)}?&quot; + pair + &quot;(\\z|#{Regexp.escape(self::SEPARATOR)}(?!#{Regexp.escape(self::SEPARATOR)}))&quot;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="319">
          <span class="hits">8</span>
          
          <code class="ruby">          Regexp.new( source , Utils::KCODE_UTF8)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="320">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="321">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="322">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="323">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="324">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="325">
          <span class="hits">1</span>
          
          <code class="ruby">    extend ClassMethods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">    def escape(x)</code>
        </li>
      
        <li class="covered" data-hits="504" data-linenumber="328">
          <span class="hits">504</span>
          
          <code class="ruby">      Utils.escape_url(Utils.object_to_param(x))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="329">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="331">
          <span class="hits">1</span>
          
          <code class="ruby">    def unescape(x)</code>
        </li>
      
        <li class="covered" data-hits="365" data-linenumber="332">
          <span class="hits">365</span>
          
          <code class="ruby">      Utils.unescape_url(x)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="334">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">    SPLITTER = /^(?:,(,*)|([^,]+))/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="336">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">    def decode(x, split = true)</code>
        </li>
      
        <li class="covered" data-hits="381" data-linenumber="338">
          <span class="hits">381</span>
          
          <code class="ruby">      if x.nil?</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="339">
          <span class="hits">6</span>
          
          <code class="ruby">        if self.class::PAIR_IF_EMPTY</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="340">
          
          
          <code class="ruby">          return x</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="341">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="342">
          <span class="hits">6</span>
          
          <code class="ruby">          return ''</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="343">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="375" data-linenumber="344">
          <span class="hits">375</span>
          
          <code class="ruby">      elsif split</code>
        </li>
      
        <li class="covered" data-hits="247" data-linenumber="345">
          <span class="hits">247</span>
          
          <code class="ruby">        r = []</code>
        </li>
      
        <li class="covered" data-hits="247" data-linenumber="346">
          <span class="hits">247</span>
          
          <code class="ruby">        v = x</code>
        </li>
      
        <li class="covered" data-hits="247" data-linenumber="347">
          <span class="hits">247</span>
          
          <code class="ruby">        until v.size == 0</code>
        </li>
      
        <li class="covered" data-hits="455" data-linenumber="348">
          <span class="hits">455</span>
          
          <code class="ruby">          m = SPLITTER.match(v)</code>
        </li>
      
        <li class="covered" data-hits="455" data-linenumber="349">
          <span class="hits">455</span>
          
          <code class="ruby">          if m[1] and m[1].size &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="350">
          <span class="hits">4</span>
          
          <code class="ruby">            r &lt;&lt; m[1]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="351">
          
          
          <code class="ruby">          elsif m[2]</code>
        </li>
      
        <li class="covered" data-hits="339" data-linenumber="352">
          <span class="hits">339</span>
          
          <code class="ruby">            r &lt;&lt; unescape(m[2])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="353">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="455" data-linenumber="354">
          <span class="hits">455</span>
          
          <code class="ruby">          v = m.post_match</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="355">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="247" data-linenumber="356">
          <span class="hits">247</span>
          
          <code class="ruby">        case(r.size)</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="357">
          <span class="hits">20</span>
          
          <code class="ruby">          when 0 then ''</code>
        </li>
      
        <li class="covered" data-hits="193" data-linenumber="358">
          <span class="hits">193</span>
          
          <code class="ruby">          when 1 then r.first</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="359">
          <span class="hits">34</span>
          
          <code class="ruby">          else r</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="361">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="362">
          <span class="hits">128</span>
          
          <code class="ruby">        unescape(x)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">    def cut(str,chars)</code>
        </li>
      
        <li class="covered" data-hits="261" data-linenumber="367">
          <span class="hits">261</span>
          
          <code class="ruby">      if chars &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="368">
          <span class="hits">19</span>
          
          <code class="ruby">        md = Regexp.compile(&quot;\\A#{self.class::CHARACTER_CLASS[:class]}{,#{chars.to_s}}&quot;, Utils::KCODE_UTF8).match(str)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="369">
          
          
          <code class="ruby">        #TODO: handle invalid matches</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="370">
          <span class="hits">19</span>
          
          <code class="ruby">        return md[0]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="371">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="242" data-linenumber="372">
          <span class="hits">242</span>
          
          <code class="ruby">        return str</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="373">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="374">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="375">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">    def pair(key, value, max_length = 0)</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="377">
          <span class="hits">128</span>
          
          <code class="ruby">      ek = escape(key)</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="378">
          <span class="hits">128</span>
          
          <code class="ruby">      ev = escape(value)</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="379">
          <span class="hits">128</span>
          
          <code class="ruby">      if !self.class::PAIR_IF_EMPTY and ev.size == 0</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="380">
          <span class="hits">6</span>
          
          <code class="ruby">        return ek</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="122" data-linenumber="382">
          <span class="hits">122</span>
          
          <code class="ruby">        return ek + self.class::PAIR_CONNECTOR + cut( ev, max_length )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="383">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="384">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="385">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="386">
          <span class="hits">1</span>
          
          <code class="ruby">    def transform_hash(name, hsh, expand , max_length)</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="387">
          <span class="hits">28</span>
          
          <code class="ruby">      if expand</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="388">
          <span class="hits">76</span>
          
          <code class="ruby">        hsh.map{|key,value| pair(key,value) }</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="389">
          <span class="hits">8</span>
          
          <code class="ruby">      elsif hsh.none?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="390">
          
          
          <code class="ruby">        []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="391">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="392">
          <span class="hits">32</span>
          
          <code class="ruby">        [ (self.class::NAMED ? escape(name)+self.class::PAIR_CONNECTOR : '' ) + hsh.map{|key,value| escape(key)+self.class::LIST_CONNECTOR+escape(value) }.join(self.class::LIST_CONNECTOR) ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">    def transform_array(name, ary, expand , max_length)</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="397">
          <span class="hits">52</span>
          
          <code class="ruby">      if expand</code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="398">
          <span class="hits">93</span>
          
          <code class="ruby">        ary.map{|value| escape(value) }</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="399">
          <span class="hits">27</span>
          
          <code class="ruby">      elsif ary.none?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">        []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="401">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="402">
          <span class="hits">128</span>
          
          <code class="ruby">        [ (self.class::NAMED ? escape(name)+self.class::PAIR_CONNECTOR : '' ) + ary.map{|value| escape(value) }.join(self.class::LIST_CONNECTOR) ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="403">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="404">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="405">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">    class Reserved &lt; self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="408">
          <span class="hits">1</span>
          
          <code class="ruby">      CHARACTER_CLASS = CHARACTER_CLASSES[:unreserved_reserved_pct]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="409">
          <span class="hits">1</span>
          
          <code class="ruby">      OPERATOR = '+'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="410">
          <span class="hits">1</span>
          
          <code class="ruby">      BASE_LEVEL = 2</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="412">
          <span class="hits">1</span>
          
          <code class="ruby">      def escape(x)</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="413">
          <span class="hits">67</span>
          
          <code class="ruby">        Utils.escape_uri(Utils.object_to_param(x))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="414">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="415">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">      def unescape(x)</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="417">
          <span class="hits">56</span>
          
          <code class="ruby">        Utils.unescape_uri(x)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="418">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="419">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="420">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="422">
          <span class="hits">1</span>
          
          <code class="ruby">    class Fragment &lt; self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="423">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="424">
          <span class="hits">1</span>
          
          <code class="ruby">      CHARACTER_CLASS = CHARACTER_CLASSES[:unreserved_reserved_pct]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="425">
          <span class="hits">1</span>
          
          <code class="ruby">      PREFIX = '#'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">      OPERATOR = '#'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="427">
          <span class="hits">1</span>
          
          <code class="ruby">      BASE_LEVEL = 2</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="428">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="429">
          <span class="hits">1</span>
          
          <code class="ruby">      def escape(x)</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="430">
          <span class="hits">56</span>
          
          <code class="ruby">        Utils.escape_uri(Utils.object_to_param(x))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="431">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="432">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">      def unescape(x)</code>
        </li>
      
        <li class="covered" data-hits="46" data-linenumber="434">
          <span class="hits">46</span>
          
          <code class="ruby">        Utils.unescape_uri(x)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="435">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="436">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="437">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="438">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">    class Label &lt; self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="440">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="441">
          <span class="hits">1</span>
          
          <code class="ruby">      SEPARATOR = '.'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="442">
          <span class="hits">1</span>
          
          <code class="ruby">      PREFIX = '.'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="443">
          <span class="hits">1</span>
          
          <code class="ruby">      OPERATOR = '.'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="444">
          <span class="hits">1</span>
          
          <code class="ruby">      BASE_LEVEL = 3</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="445">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="446">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="447">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">    class Path &lt; self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="449">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">      SEPARATOR = '/'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">      PREFIX = '/'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">      OPERATOR = '/'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">      BASE_LEVEL = 3</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="454">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="455">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="456">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="457">
          <span class="hits">1</span>
          
          <code class="ruby">    class PathParameters &lt; self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="459">
          <span class="hits">1</span>
          
          <code class="ruby">      SEPARATOR = ';'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="460">
          <span class="hits">1</span>
          
          <code class="ruby">      PREFIX = ';'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">      NAMED = true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">      PAIR_IF_EMPTY = false</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">      OPERATOR = ';'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">      BASE_LEVEL = 3</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="465">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="466">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="467">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">    class FormQuery &lt; self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="469">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">      SEPARATOR = '&amp;'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="471">
          <span class="hits">1</span>
          
          <code class="ruby">      PREFIX = '?'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="472">
          <span class="hits">1</span>
          
          <code class="ruby">      NAMED = true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="473">
          <span class="hits">1</span>
          
          <code class="ruby">      OPERATOR = '?'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="474">
          <span class="hits">1</span>
          
          <code class="ruby">      BASE_LEVEL = 3</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="475">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="476">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="477">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="478">
          <span class="hits">1</span>
          
          <code class="ruby">    class FormQueryContinuation &lt; self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="479">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="480">
          <span class="hits">1</span>
          
          <code class="ruby">      SEPARATOR = '&amp;'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">      PREFIX = '&amp;'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">      NAMED = true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">      OPERATOR = '&amp;'.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">      BASE_LEVEL = 3</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="485">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="486">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="487">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="488">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">  # @private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="491">
          <span class="hits">1</span>
          
          <code class="ruby">  OPERATORS = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="492">
          
          
          <code class="ruby">    ''  =&gt; Expression,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="493">
          
          
          <code class="ruby">    '+' =&gt; Expression::Reserved,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="494">
          
          
          <code class="ruby">    '#' =&gt; Expression::Fragment,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="495">
          
          
          <code class="ruby">    '.' =&gt; Expression::Label,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="496">
          
          
          <code class="ruby">    '/' =&gt; Expression::Path,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="497">
          
          
          <code class="ruby">    ';' =&gt; Expression::PathParameters,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="498">
          
          
          <code class="ruby">    '?' =&gt; Expression::FormQuery,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="499">
          
          
          <code class="ruby">    '&amp;' =&gt; Expression::FormQueryContinuation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="500">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="501">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="502">
          
          
          <code class="ruby">  # This error is raised when an invalid pattern was given.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="503">
          <span class="hits">1</span>
          
          <code class="ruby">  class Invalid &lt; StandardError</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="505">
          <span class="hits">1</span>
          
          <code class="ruby">    include URITemplate::Invalid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="506">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="507">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :pattern, :position</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="508">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(source, position)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="510">
          <span class="hits">5</span>
          
          <code class="ruby">      @pattern = pattern</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="511">
          <span class="hits">5</span>
          
          <code class="ruby">      @position = position</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="512">
          <span class="hits">5</span>
          
          <code class="ruby">      super(&quot;Invalid expression found in #{source.inspect} at #{position}: '#{source[position..-1]}'&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="513">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="514">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="515">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="516">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="517">
          
          
          <code class="ruby">  # @private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="518">
          <span class="hits">1</span>
          
          <code class="ruby">  class Tokenizer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="520">
          <span class="hits">1</span>
          
          <code class="ruby">    include Enumerable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="522">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :source</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="523">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(source)</code>
        </li>
      
        <li class="covered" data-hits="345" data-linenumber="525">
          <span class="hits">345</span>
          
          <code class="ruby">      @source = source</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="526">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="527">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="528">
          <span class="hits">1</span>
          
          <code class="ruby">    def each</code>
        </li>
      
        <li class="covered" data-hits="345" data-linenumber="529">
          <span class="hits">345</span>
          
          <code class="ruby">      if !block_given?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="530">
          
          
          <code class="ruby">        return Enumerator.new(self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="531">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="345" data-linenumber="532">
          <span class="hits">345</span>
          
          <code class="ruby">      scanner = StringScanner.new(@source)</code>
        </li>
      
        <li class="covered" data-hits="345" data-linenumber="533">
          <span class="hits">345</span>
          
          <code class="ruby">      until scanner.eos?</code>
        </li>
      
        <li class="covered" data-hits="465" data-linenumber="534">
          <span class="hits">465</span>
          
          <code class="ruby">        expression = scanner.scan(EXPRESSION)</code>
        </li>
      
        <li class="covered" data-hits="465" data-linenumber="535">
          <span class="hits">465</span>
          
          <code class="ruby">        if expression</code>
        </li>
      
        <li class="covered" data-hits="310" data-linenumber="536">
          <span class="hits">310</span>
          
          <code class="ruby">          vars = scanner[2].split(',').map{|name|</code>
        </li>
      
        <li class="covered" data-hits="410" data-linenumber="537">
          <span class="hits">410</span>
          
          <code class="ruby">            match = VAR.match(name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="538">
          
          
          <code class="ruby">            # 1 = varname</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="539">
          
          
          <code class="ruby">            # 2 = explode</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby">            # 3 = length</code>
        </li>
      
        <li class="covered" data-hits="410" data-linenumber="541">
          <span class="hits">410</span>
          
          <code class="ruby">            [ match[1], match[2] == '*', match[3].to_i ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="542">
          
          
          <code class="ruby">          }</code>
        </li>
      
        <li class="covered" data-hits="310" data-linenumber="543">
          <span class="hits">310</span>
          
          <code class="ruby">          yield OPERATORS[scanner[1]].new(vars)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="544">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="155" data-linenumber="545">
          <span class="hits">155</span>
          
          <code class="ruby">          literal = scanner.scan(LITERAL)</code>
        </li>
      
        <li class="covered" data-hits="155" data-linenumber="546">
          <span class="hits">155</span>
          
          <code class="ruby">          if literal</code>
        </li>
      
        <li class="covered" data-hits="150" data-linenumber="547">
          <span class="hits">150</span>
          
          <code class="ruby">            yield(Literal.new(literal))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="548">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="549">
          <span class="hits">5</span>
          
          <code class="ruby">            raise Invalid.new(@source,scanner.pos)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="550">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="551">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="552">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="553">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="554">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="555">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="556">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="557">
          
          
          <code class="ruby">  # The class methods for all draft7 templates.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="558">
          <span class="hits">1</span>
          
          <code class="ruby">  module ClassMethods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="559">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="560">
          
          
          <code class="ruby">    # Tries to convert the given param in to a instance of {Draft7}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="561">
          
          
          <code class="ruby">    # It basically passes thru instances of that class, parses strings and return nil on everything else.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="562">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="563">
          
          
          <code class="ruby">    # @example</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="564">
          
          
          <code class="ruby">    #   URITemplate::Draft7.try_convert( Object.new ) #=&gt; nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="565">
          
          
          <code class="ruby">    #   tpl = URITemplate::Draft7.new('{foo}')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="566">
          
          
          <code class="ruby">    #   URITemplate::Draft7.try_convert( tpl ) #=&gt; tpl</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="567">
          
          
          <code class="ruby">    #   URITemplate::Draft7.try_convert('{foo}') #=&gt; tpl</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="568">
          
          
          <code class="ruby">    #   URITemplate::Draft7.try_convert(URITemplate.new(:colon, ':foo')) #=&gt; tpl</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="569">
          
          
          <code class="ruby">    #   # This pattern is invalid, so it wont be parsed:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="570">
          
          
          <code class="ruby">    #   URITemplate::Draft7.try_convert('{foo') #=&gt; nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="571">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="572">
          <span class="hits">1</span>
          
          <code class="ruby">    def try_convert(x)</code>
        </li>
      
        <li class="covered" data-hits="35" data-linenumber="573">
          <span class="hits">35</span>
          
          <code class="ruby">      if x.kind_of? self</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="574">
          <span class="hits">1</span>
          
          <code class="ruby">        return x</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="575">
          <span class="hits">34</span>
          
          <code class="ruby">      elsif x.kind_of? String and valid? x</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="576">
          <span class="hits">25</span>
          
          <code class="ruby">        return new(x)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="577">
          <span class="hits">9</span>
          
          <code class="ruby">      elsif x.kind_of? URITemplate::Colon</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="578">
          
          
          <code class="ruby">        return new( x.tokens.map{|tk|</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="579">
          <span class="hits">10</span>
          
          <code class="ruby">          if tk.literal?</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="580">
          <span class="hits">7</span>
          
          <code class="ruby">            Literal.new(tk.string)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="581">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="582">
          <span class="hits">3</span>
          
          <code class="ruby">            Expression.new([[tk.variables.first, false, 0]])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="583">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="584">
          <span class="hits">5</span>
          
          <code class="ruby">        })</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="585">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="586">
          
          
          <code class="ruby">        return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="587">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="588">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="589">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="590">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="591">
          
          
          <code class="ruby">    # Like {.try_convert}, but raises an ArgumentError, when the conversion failed.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="592">
          
          
          <code class="ruby">    # </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="593">
          
          
          <code class="ruby">    # @raise ArgumentError</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="594">
          <span class="hits">1</span>
          
          <code class="ruby">    def convert(x)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="595">
          
          
          <code class="ruby">      o = self.try_convert(x)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="596">
          
          
          <code class="ruby">      if o.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="597">
          
          
          <code class="ruby">        raise ArgumentError, &quot;Expected to receive something that can be converted to an #{self.class}, but got: #{x.inspect}.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="598">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="599">
          
          
          <code class="ruby">        return o</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="600">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="601">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="602">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="603">
          
          
          <code class="ruby">    # Tests whether a given pattern is a valid template pattern.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="604">
          
          
          <code class="ruby">    # @example</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="605">
          
          
          <code class="ruby">    #   URITemplate::Draft7.valid? 'foo' #=&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="606">
          
          
          <code class="ruby">    #   URITemplate::Draft7.valid? '{foo}' #=&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="607">
          
          
          <code class="ruby">    #   URITemplate::Draft7.valid? '{foo' #=&gt; false</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="608">
          <span class="hits">1</span>
          
          <code class="ruby">    def valid?(pattern)</code>
        </li>
      
        <li class="covered" data-hits="138" data-linenumber="609">
          <span class="hits">138</span>
          
          <code class="ruby">      URI === pattern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="610">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="611">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="612">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="613">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="614">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ClassMethods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="615">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="616">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="617">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="618">
          
          
          <code class="ruby">  # @param String,Array either a pattern as String or an Array of tokens</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="619">
          
          
          <code class="ruby">  # @param Hash some options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="620">
          
          
          <code class="ruby">  # @option :lazy If true the pattern will be parsed on first access, this also means that syntax errors will not be detected unless accessed.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="621">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(pattern_or_tokens,options={})</code>
        </li>
      
        <li class="covered" data-hits="376" data-linenumber="622">
          <span class="hits">376</span>
          
          <code class="ruby">    @options = options.dup.freeze</code>
        </li>
      
        <li class="covered" data-hits="376" data-linenumber="623">
          <span class="hits">376</span>
          
          <code class="ruby">    if pattern_or_tokens.kind_of? String</code>
        </li>
      
        <li class="covered" data-hits="345" data-linenumber="624">
          <span class="hits">345</span>
          
          <code class="ruby">      @pattern = pattern_or_tokens.dup</code>
        </li>
      
        <li class="covered" data-hits="345" data-linenumber="625">
          <span class="hits">345</span>
          
          <code class="ruby">      @pattern.freeze</code>
        </li>
      
        <li class="covered" data-hits="345" data-linenumber="626">
          <span class="hits">345</span>
          
          <code class="ruby">      unless @options[:lazy]</code>
        </li>
      
        <li class="covered" data-hits="345" data-linenumber="627">
          <span class="hits">345</span>
          
          <code class="ruby">        self.tokens</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="628">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="629">
          <span class="hits">31</span>
          
          <code class="ruby">    elsif pattern_or_tokens.kind_of? Array</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="630">
          <span class="hits">30</span>
          
          <code class="ruby">      @tokens = pattern_or_tokens.dup</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="631">
          <span class="hits">30</span>
          
          <code class="ruby">      @tokens.freeze</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="632">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="633">
          <span class="hits">1</span>
          
          <code class="ruby">      raise ArgumentError, &quot;Expected to receive a pattern string, but got #{pattern_or_tokens.inspect}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="634">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="635">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="636">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="637">
          
          
          <code class="ruby">  # @method expand(variables = {})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="638">
          
          
          <code class="ruby">  # Expands the template with the given variables.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="639">
          
          
          <code class="ruby">  # The expansion should be compatible to uritemplate spec draft 7 ( http://tools.ietf.org/html/draft-gregorio-uritemplate-07 ).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="640">
          
          
          <code class="ruby">  # @note</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="641">
          
          
          <code class="ruby">  #   All keys of the supplied hash should be strings as anything else won't be recognised.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="642">
          
          
          <code class="ruby">  # @note</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="643">
          
          
          <code class="ruby">  #   There are neither default values for variables nor will anything be raised if a variable is missing. Please read the spec if you want to know how undefined variables are handled.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="644">
          
          
          <code class="ruby">  # @example</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="645">
          
          
          <code class="ruby">  #   URITemplate::Draft7.new('{foo}').expand('foo'=&gt;'bar') #=&gt; 'bar'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="646">
          
          
          <code class="ruby">  #   URITemplate::Draft7.new('{?args*}').expand('args'=&gt;{'key'=&gt;'value'}) #=&gt; '?key=value'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="647">
          
          
          <code class="ruby">  #   URITemplate::Draft7.new('{undef}').expand() #=&gt; ''</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="648">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="649">
          
          
          <code class="ruby">  # @param variables Hash</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="650">
          
          
          <code class="ruby">  # @return String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="651">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="652">
          
          
          <code class="ruby">  # Compiles this template into a regular expression which can be used to test whether a given uri matches this template. This template is also used for {#===}.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="653">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="654">
          
          
          <code class="ruby">  # @example</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="655">
          
          
          <code class="ruby">  #   tpl = URITemplate::Draft7.new('/foo/{bar}/')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="656">
          
          
          <code class="ruby">  #   regex = tpl.to_r</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="657">
          
          
          <code class="ruby">  #   regex === '/foo/baz/' #=&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="658">
          
          
          <code class="ruby">  #   regex === '/foz/baz/' #=&gt; false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="659">
          
          
          <code class="ruby">  # </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="660">
          
          
          <code class="ruby">  # @return Regexp</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="661">
          <span class="hits">1</span>
          
          <code class="ruby">  def to_r</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="662">
          
          
          <code class="ruby">    @regexp ||= begin</code>
        </li>
      
        <li class="covered" data-hits="124" data-linenumber="663">
          <span class="hits">124</span>
          
          <code class="ruby">      source = tokens.map(&amp;:to_r_source)</code>
        </li>
      
        <li class="covered" data-hits="124" data-linenumber="664">
          <span class="hits">124</span>
          
          <code class="ruby">      source.unshift('\A')</code>
        </li>
      
        <li class="covered" data-hits="124" data-linenumber="665">
          <span class="hits">124</span>
          
          <code class="ruby">      source.push('\z')</code>
        </li>
      
        <li class="covered" data-hits="124" data-linenumber="666">
          <span class="hits">124</span>
          
          <code class="ruby">      Regexp.new( source.join, Utils::KCODE_UTF8)</code>
        </li>
      
        <li class="covered" data-hits="237" data-linenumber="667">
          <span class="hits">237</span>
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="668">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="669">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="670">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="671">
          
          
          <code class="ruby">  # Extracts variables from a uri ( given as string ) or an instance of MatchData ( which was matched by the regexp of this template.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="672">
          
          
          <code class="ruby">  # The actual result depends on the value of post_processing.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="673">
          
          
          <code class="ruby">  # This argument specifies whether pair arrays should be converted to hashes.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="674">
          
          
          <code class="ruby">  # </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="675">
          
          
          <code class="ruby">  # @example Default Processing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="676">
          
          
          <code class="ruby">  #   URITemplate::Draft7.new('{var}').extract('value') #=&gt; {'var'=&gt;'value'}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="677">
          
          
          <code class="ruby">  #   URITemplate::Draft7.new('{&amp;args*}').extract('&amp;a=1&amp;b=2') #=&gt; {'args'=&gt;{'a'=&gt;'1','b'=&gt;'2'}}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="678">
          
          
          <code class="ruby">  #   URITemplate::Draft7.new('{&amp;arg,arg}').extract('&amp;arg=1&amp;arg=2') #=&gt; {'arg'=&gt;'2'}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="679">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="680">
          
          
          <code class="ruby">  # @example No Processing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="681">
          
          
          <code class="ruby">  #   URITemplate::Draft7.new('{var}').extract('value', URITemplate::Draft7::NO_PROCESSING) #=&gt; [['var','value']]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="682">
          
          
          <code class="ruby">  #   URITemplate::Draft7.new('{&amp;args*}').extract('&amp;a=1&amp;b=2', URITemplate::Draft7::NO_PROCESSING) #=&gt; [['args',[['a','1'],['b','2']]]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="683">
          
          
          <code class="ruby">  #   URITemplate::Draft7.new('{&amp;arg,arg}').extract('&amp;arg=1&amp;arg=2', URITemplate::Draft7::NO_PROCESSING) #=&gt; [['arg','1'],['arg','2']]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="684">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="685">
          
          
          <code class="ruby">  # @raise Encoding::InvalidByteSequenceError when the given uri was not properly encoded.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="686">
          
          
          <code class="ruby">  # @raise Encoding::UndefinedConversionError when the given uri could not be converted to utf-8.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="687">
          
          
          <code class="ruby">  # @raise Encoding::CompatibilityError when the given uri could not be converted to utf-8.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="688">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="689">
          
          
          <code class="ruby">  # @param [String,MatchData] Uri_or_MatchData A uri or a matchdata from which the variables should be extracted.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="690">
          
          
          <code class="ruby">  # @param [Array] Processing Specifies which processing should be done.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="691">
          
          
          <code class="ruby">  # </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="692">
          
          
          <code class="ruby">  # @note</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="693">
          
          
          <code class="ruby">  #   Don't expect that an extraction can fully recover the expanded variables. Extract rather generates a variable list which should expand to the uri from which it were extracted. In general the following equation should hold true:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="694">
          
          
          <code class="ruby">  #     a_tpl.expand( a_tpl.extract( an_uri ) ) == an_uri</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="695">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="696">
          
          
          <code class="ruby">  # @example Extraction cruces</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="697">
          
          
          <code class="ruby">  #   two_lists = URITemplate::Draft7.new('{listA*,listB*}')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="698">
          
          
          <code class="ruby">  #   uri = two_lists.expand('listA'=&gt;[1,2],'listB'=&gt;[3,4]) #=&gt; &quot;1,2,3,4&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="699">
          
          
          <code class="ruby">  #   variables = two_lists.extract( uri ) #=&gt; {'listA'=&gt;[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;],'listB'=&gt;nil}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="700">
          
          
          <code class="ruby">  #   # However, like said in the note:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="701">
          
          
          <code class="ruby">  #   two_lists.expand( variables ) == uri #=&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="702">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="703">
          
          
          <code class="ruby">  # @note</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="704">
          
          
          <code class="ruby">  #   The current implementation drops duplicated variables instead of checking them.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="705">
          
          
          <code class="ruby">  #   </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="706">
          
          
          <code class="ruby">  #   </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="707">
          <span class="hits">1</span>
          
          <code class="ruby">  def extract(uri_or_match, post_processing = DEFAULT_PROCESSING )</code>
        </li>
      
        <li class="covered" data-hits="234" data-linenumber="708">
          <span class="hits">234</span>
          
          <code class="ruby">    if uri_or_match.kind_of? String</code>
        </li>
      
        <li class="covered" data-hits="230" data-linenumber="709">
          <span class="hits">230</span>
          
          <code class="ruby">      m = self.to_r.match(uri_or_match)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="710">
          
          
          <code class="ruby">    elsif uri_or_match.kind_of?(MatchData)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="711">
          <span class="hits">3</span>
          
          <code class="ruby">      if uri_or_match.respond_to?(:regexp) and uri_or_match.regexp != self.to_r</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="712">
          <span class="hits">2</span>
          
          <code class="ruby">        raise ArgumentError, &quot;Trying to extract variables from MatchData which was not generated by this template.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="713">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="714">
          <span class="hits">1</span>
          
          <code class="ruby">      m = uri_or_match</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="715">
          
          
          <code class="ruby">    elsif uri_or_match.nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="716">
          <span class="hits">1</span>
          
          <code class="ruby">      return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="717">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="718">
          
          
          <code class="ruby">      raise ArgumentError, &quot;Expected to receive a String or a MatchData, but got #{uri_or_match.inspect}.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="719">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="231" data-linenumber="720">
          <span class="hits">231</span>
          
          <code class="ruby">    if m.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="721">
          
          
          <code class="ruby">      return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="722">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="230" data-linenumber="723">
          <span class="hits">230</span>
          
          <code class="ruby">      result = extract_matchdata(m, post_processing)</code>
        </li>
      
        <li class="covered" data-hits="230" data-linenumber="724">
          <span class="hits">230</span>
          
          <code class="ruby">      if block_given?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="725">
          <span class="hits">1</span>
          
          <code class="ruby">        return yield result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="726">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="727">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="229" data-linenumber="728">
          <span class="hits">229</span>
          
          <code class="ruby">      return result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="729">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="730">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="731">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="732">
          
          
          <code class="ruby">  # Extracts variables without any proccessing.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="733">
          
          
          <code class="ruby">  # This is equivalent to {#extract} with options {NO_PROCESSING}.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="734">
          
          
          <code class="ruby">  # @see #extract</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="735">
          <span class="hits">1</span>
          
          <code class="ruby">  def extract_simple(uri_or_match)</code>
        </li>
      
        <li class="covered" data-hits="109" data-linenumber="736">
          <span class="hits">109</span>
          
          <code class="ruby">    extract( uri_or_match, NO_PROCESSING )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="737">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="738">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="739">
          
          
          <code class="ruby">  # Returns the pattern for this template.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="740">
          <span class="hits">1</span>
          
          <code class="ruby">  def pattern</code>
        </li>
      
        <li class="covered" data-hits="433" data-linenumber="741">
          <span class="hits">433</span>
          
          <code class="ruby">    @pattern ||= tokens.map(&amp;:to_s).join</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="742">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="743">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="744">
          <span class="hits">1</span>
          
          <code class="ruby">  alias to_s pattern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="745">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="746">
          
          
          <code class="ruby">  # Compares two template patterns.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="747">
          <span class="hits">1</span>
          
          <code class="ruby">  def ==(o)</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="748">
          <span class="hits">21</span>
          
          <code class="ruby">    this, other, this_converted, _ = URITemplate.coerce( self, o )</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="749">
          <span class="hits">21</span>
          
          <code class="ruby">    if this_converted</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="750">
          
          
          <code class="ruby">      return this == other</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="751">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="752">
          <span class="hits">21</span>
          
          <code class="ruby">    return this.pattern == other.pattern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="753">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="754">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="755">
          
          
          <code class="ruby">  # @method ===(uri)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="756">
          
          
          <code class="ruby">  # Alias for to_r.=== . Tests whether this template matches a given uri.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="757">
          
          
          <code class="ruby">  # @return TrueClass, FalseClass</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="758">
          <span class="hits">1</span>
          
          <code class="ruby">  def_delegators :to_r, :===</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="759">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="760">
          
          
          <code class="ruby">  # @method match(uri)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="761">
          
          
          <code class="ruby">  # Alias for to_r.match . Matches this template against the given uri.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="762">
          
          
          <code class="ruby">  # @yield MatchData</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="763">
          
          
          <code class="ruby">  # @return MatchData, Object </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="764">
          <span class="hits">1</span>
          
          <code class="ruby">  def_delegators :to_r, :match</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="765">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="766">
          
          
          <code class="ruby">  # The type of this template.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="767">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="768">
          
          
          <code class="ruby">  # @example</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="769">
          
          
          <code class="ruby">  #   tpl1 = URITemplate::Draft7.new('/foo')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="770">
          
          
          <code class="ruby">  #   tpl2 = URITemplate.new( tpl1.pattern, tpl1.type )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="771">
          
          
          <code class="ruby">  #   tpl1 == tpl2 #=&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="772">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="773">
          
          
          <code class="ruby">  # @see {URITemplate#type}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="774">
          <span class="hits">1</span>
          
          <code class="ruby">  def type</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="775">
          <span class="hits">5</span>
          
          <code class="ruby">    :draft7</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="776">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="777">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="778">
          
          
          <code class="ruby">  # Returns the level of this template according to the draft ( http://tools.ietf.org/html/draft-gregorio-uritemplate-07#section-1.2 ). Higher level means higher complexity.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="779">
          
          
          <code class="ruby">  # Basically this is defined as:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="780">
          
          
          <code class="ruby">  # </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="781">
          
          
          <code class="ruby">  # * Level 1: no operators, one variable per expansion, no variable modifiers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="782">
          
          
          <code class="ruby">  # * Level 2: '+' and '#' operators, one variable per expansion, no variable modifiers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="783">
          
          
          <code class="ruby">  # * Level 3: all operators, multiple variables per expansion, no variable modifiers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="784">
          
          
          <code class="ruby">  # * Level 4: all operators, multiple variables per expansion, all variable modifiers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="785">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="786">
          
          
          <code class="ruby">  # @example</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="787">
          
          
          <code class="ruby">  #   URITemplate::Draft7.new('/foo/').level #=&gt; 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="788">
          
          
          <code class="ruby">  #   URITemplate::Draft7.new('/foo{bar}').level #=&gt; 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="789">
          
          
          <code class="ruby">  #   URITemplate::Draft7.new('/foo{#bar}').level #=&gt; 2</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="790">
          
          
          <code class="ruby">  #   URITemplate::Draft7.new('/foo{.bar}').level #=&gt; 3</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="791">
          
          
          <code class="ruby">  #   URITemplate::Draft7.new('/foo{bar,baz}').level #=&gt; 3</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="792">
          
          
          <code class="ruby">  #   URITemplate::Draft7.new('/foo{bar:20}').level #=&gt; 4</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="793">
          
          
          <code class="ruby">  #   URITemplate::Draft7.new('/foo{bar*}').level #=&gt; 4</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="794">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="795">
          
          
          <code class="ruby">  # Templates of lower levels might be convertible to other formats while templates of higher levels might be incompatible. Level 1 for example should be convertible to any other format since it just contains simple expansions.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="796">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="797">
          <span class="hits">1</span>
          
          <code class="ruby">  def level</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="798">
          <span class="hits">30</span>
          
          <code class="ruby">    tokens.map(&amp;:level).max</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="799">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="800">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="801">
          
          
          <code class="ruby">  # Tries to concatenate two templates, as if they were path segments.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="802">
          
          
          <code class="ruby">  # Removes double slashes or insert one if they are missing.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="803">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="804">
          
          
          <code class="ruby">  # @example</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="805">
          
          
          <code class="ruby">  #   tpl = URITemplate::Draft7.new('/xy/')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="806">
          
          
          <code class="ruby">  #   (tpl / '/z/' ).pattern #=&gt; '/xy/z/'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="807">
          
          
          <code class="ruby">  #   (tpl / 'z/' ).pattern #=&gt; '/xy/z/'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="808">
          
          
          <code class="ruby">  #   (tpl / '{/z}' ).pattern #=&gt; '/xy{/z}'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="809">
          
          
          <code class="ruby">  #   (tpl / 'a' / 'b' ).pattern #=&gt; '/xy/a/b'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="810">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="811">
          <span class="hits">1</span>
          
          <code class="ruby">  def /(o)</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="812">
          <span class="hits">25</span>
          
          <code class="ruby">    this, other, this_converted, _ = URITemplate.coerce( self, o )</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="813">
          <span class="hits">25</span>
          
          <code class="ruby">    if this_converted</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="814">
          
          
          <code class="ruby">      return this / other</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="815">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="816">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="817">
          <span class="hits">25</span>
          
          <code class="ruby">    if other.absolute?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="818">
          <span class="hits">3</span>
          
          <code class="ruby">      raise ArgumentError, &quot;Expected to receive a relative template but got an absoulte one: #{other.inspect}. If you think this is a bug, please report it.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="819">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="820">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="821">
          <span class="hits">22</span>
          
          <code class="ruby">    if other.pattern == ''</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="822">
          <span class="hits">1</span>
          
          <code class="ruby">      return self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="823">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="824">
          
          
          <code class="ruby">    # Merge!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="825">
          
          
          <code class="ruby">    # Analyze the last token of this an the first token of the next and try to merge them</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="826">
          <span class="hits">21</span>
          
          <code class="ruby">    if self.tokens.last.kind_of?(Literal)</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="827">
          <span class="hits">19</span>
          
          <code class="ruby">      if self.tokens.last.string[-1] == SLASH # the last token ends with an /</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="828">
          <span class="hits">7</span>
          
          <code class="ruby">        if other.tokens.first.kind_of? Literal</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="829">
          
          
          <code class="ruby">          # both seems to be paths, merge them!</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="830">
          <span class="hits">5</span>
          
          <code class="ruby">          if other.tokens.first.string[0] == SLASH</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="831">
          
          
          <code class="ruby">            # strip one '/'</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="832">
          <span class="hits">2</span>
          
          <code class="ruby">            return self.class.new( self.tokens[0..-2] + [ Literal.new(self.tokens.last.string + other.tokens.first.string[1..-1]) ] + other.tokens[1..-1] )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="833">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="834">
          
          
          <code class="ruby">            # no problem, but we can merge them</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="835">
          <span class="hits">3</span>
          
          <code class="ruby">            return self.class.new( self.tokens[0..-2] + [ Literal.new(self.tokens.last.string + other.tokens.first.string) ] + other.tokens[1..-1] )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="836">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="837">
          
          
          <code class="ruby">        elsif other.tokens.first.kind_of? Expression::Path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="838">
          
          
          <code class="ruby">          # this will automatically insert '/'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="839">
          
          
          <code class="ruby">          # so we can strip one '/'</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="840">
          <span class="hits">2</span>
          
          <code class="ruby">          return self.class.new( self.tokens[0..-2] + [ Literal.new(self.tokens.last.string[0..-2]) ] + other.tokens )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="841">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="842">
          
          
          <code class="ruby">      elsif other.tokens.first.kind_of? Literal</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="843">
          
          
          <code class="ruby">        # okay, this template does not end with /, but the next starts with a literal =&gt; merge them!</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="844">
          <span class="hits">9</span>
          
          <code class="ruby">        if other.tokens.first.string[0] == SLASH</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="845">
          <span class="hits">3</span>
          
          <code class="ruby">          return self.class.new( self.tokens[0..-2] + [Literal.new(self.tokens.last.string + other.tokens.first.string)] + other.tokens[1..-1] )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="846">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="847">
          <span class="hits">6</span>
          
          <code class="ruby">          return self.class.new( self.tokens[0..-2] + [Literal.new(self.tokens.last.string + '/' + other.tokens.first.string)] + other.tokens[1..-1] )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="848">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="849">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="850">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="851">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="852">
          <span class="hits">5</span>
          
          <code class="ruby">    if other.tokens.first.kind_of?(Literal)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="853">
          <span class="hits">2</span>
          
          <code class="ruby">      if other.tokens.first.string[0] == SLASH</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="854">
          <span class="hits">1</span>
          
          <code class="ruby">        return self.class.new( self.tokens + other.tokens )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="855">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="856">
          <span class="hits">1</span>
          
          <code class="ruby">        return self.class.new( self.tokens + [Literal.new('/' + other.tokens.first.string)]+ other.tokens[1..-1] )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="857">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="858">
          <span class="hits">3</span>
          
          <code class="ruby">    elsif other.tokens.first.kind_of?(Expression::Path)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="859">
          <span class="hits">2</span>
          
          <code class="ruby">      return self.class.new( self.tokens + other.tokens )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="860">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="861">
          <span class="hits">1</span>
          
          <code class="ruby">      return self.class.new( self.tokens + [Literal.new('/')] + other.tokens )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="862">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="863">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="864">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="865">
          
          
          <code class="ruby">  # Returns an array containing a the template tokens.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="866">
          <span class="hits">1</span>
          
          <code class="ruby">  def tokens</code>
        </li>
      
        <li class="covered" data-hits="1167" data-linenumber="867">
          <span class="hits">1167</span>
          
          <code class="ruby">    @tokens ||= tokenize!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="868">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="869">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="870">
          <span class="hits">1</span>
          
          <code class="ruby">protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="871">
          
          
          <code class="ruby">  # @private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="872">
          <span class="hits">1</span>
          
          <code class="ruby">  def tokenize!</code>
        </li>
      
        <li class="covered" data-hits="345" data-linenumber="873">
          <span class="hits">345</span>
          
          <code class="ruby">    Tokenizer.new(pattern).to_a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="874">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="875">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="876">
          <span class="hits">1</span>
          
          <code class="ruby">  def arity</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="877">
          
          
          <code class="ruby">    @arity ||= tokens.inject(0){|a,t| a + t.arity }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="878">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="879">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="880">
          
          
          <code class="ruby">  # @private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="881">
          <span class="hits">1</span>
          
          <code class="ruby">  def extract_matchdata(matchdata, post_processing)</code>
        </li>
      
        <li class="covered" data-hits="230" data-linenumber="882">
          <span class="hits">230</span>
          
          <code class="ruby">    bc = 1</code>
        </li>
      
        <li class="covered" data-hits="230" data-linenumber="883">
          <span class="hits">230</span>
          
          <code class="ruby">    vars = []</code>
        </li>
      
        <li class="covered" data-hits="230" data-linenumber="884">
          <span class="hits">230</span>
          
          <code class="ruby">    tokens.each{|part|</code>
        </li>
      
        <li class="covered" data-hits="317" data-linenumber="885">
          <span class="hits">317</span>
          
          <code class="ruby">      next if part.literal?</code>
        </li>
      
        <li class="covered" data-hits="240" data-linenumber="886">
          <span class="hits">240</span>
          
          <code class="ruby">      i = 0</code>
        </li>
      
        <li class="covered" data-hits="240" data-linenumber="887">
          <span class="hits">240</span>
          
          <code class="ruby">      pa = part.arity</code>
        </li>
      
        <li class="covered" data-hits="240" data-linenumber="888">
          <span class="hits">240</span>
          
          <code class="ruby">      while i &lt; pa</code>
        </li>
      
        <li class="covered" data-hits="325" data-linenumber="889">
          <span class="hits">325</span>
          
          <code class="ruby">        vars &lt;&lt; part.extract(i, matchdata[bc])</code>
        </li>
      
        <li class="covered" data-hits="325" data-linenumber="890">
          <span class="hits">325</span>
          
          <code class="ruby">        bc += 1</code>
        </li>
      
        <li class="covered" data-hits="325" data-linenumber="891">
          <span class="hits">325</span>
          
          <code class="ruby">        i += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="892">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="893">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="covered" data-hits="230" data-linenumber="894">
          <span class="hits">230</span>
          
          <code class="ruby">    if post_processing.include? :convert_result</code>
        </li>
      
        <li class="covered" data-hits="118" data-linenumber="895">
          <span class="hits">118</span>
          
          <code class="ruby">      if post_processing.include? :convert_values</code>
        </li>
      
        <li class="covered" data-hits="118" data-linenumber="896">
          <span class="hits">118</span>
          
          <code class="ruby">        vars.flatten!(1)</code>
        </li>
      
        <li class="covered" data-hits="284" data-linenumber="897">
          <span class="hits">284</span>
          
          <code class="ruby">        return Hash[*vars.map!{|k,v| [k,Utils.pair_array_to_hash(v)] }.flatten(1) ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="898">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="899">
          
          
          <code class="ruby">        vars.flatten!(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="900">
          
          
          <code class="ruby">        return Hash[*vars]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="901">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="902">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="112" data-linenumber="903">
          <span class="hits">112</span>
          
          <code class="ruby">      if post_processing.include? :convert_value</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="904">
          
          
          <code class="ruby">        vars.flatten!(1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="905">
          
          
          <code class="ruby">        return vars.collect{|k,v| [k,Utils.pair_array_to_hash(v)] }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="906">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="112" data-linenumber="907">
          <span class="hits">112</span>
          
          <code class="ruby">        return vars.flatten(1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="908">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="909">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="910">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="911">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="912">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="913">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="914">
          
          
          <code class="ruby"></code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f8d256d1ef3e0fd588dc69c54499afd0f2cfe206">
  <div class="header">
    <h3>lib/uri_template/utils.rb</h3>
    <h4><span class="green">90.82 %</span> covered</h4>
    <div>
      <b>98</b> relevant lines. 
      <span class="green"><b>89</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># -*- encoding : utf-8 -*-</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">#    This program is free software: you can redistribute it and/or modify</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">#    it under the terms of the Affero GNU General Public License as published by</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">#    the Free Software Foundation, either version 3 of the License, or</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">#    (at your option) any later version.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">#    This program is distributed in the hope that it will be useful,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">#    but WITHOUT ANY WARRANTY; without even the implied warranty of</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">#    GNU General Public License for more details.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">#    You should have received a copy of the GNU General Public License</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">#    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">#    (c) 2011 by Hannes Georg</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">module URITemplate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  # An awesome little helper which helps iterating over a string.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  # Initialize with a regexp and pass a string to :each.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  # It will yield a string or a MatchData</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  class RegexpEnumerator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    include Enumerable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(regexp)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="28">
          <span class="hits">9</span>
          
          <code class="ruby">      @regexp = regexp</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    def each(str)</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="32">
          <span class="hits">18</span>
          
          <code class="ruby">      return Enumerator.new(self,:each,str) unless block_given?</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="33">
          <span class="hits">9</span>
          
          <code class="ruby">      rest = str</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="34">
          <span class="hits">9</span>
          
          <code class="ruby">      loop do</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="35">
          <span class="hits">16</span>
          
          <code class="ruby">        m = @regexp.match(rest)</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="36">
          <span class="hits">16</span>
          
          <code class="ruby">        if m.nil?</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="37">
          <span class="hits">9</span>
          
          <code class="ruby">          yield rest</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="38">
          <span class="hits">9</span>
          
          <code class="ruby">          break</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="40">
          <span class="hits">7</span>
          
          <code class="ruby">        yield m.pre_match if m.pre_match.size &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="41">
          <span class="hits">7</span>
          
          <code class="ruby">        yield m</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="42">
          <span class="hits">7</span>
          
          <code class="ruby">        if m[0].size == 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">          # obviously matches empty string, so post_match will equal rest</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">          # terminate or this will loop forever</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">          yield m.post_match</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">          break</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="48">
          <span class="hits">7</span>
          
          <code class="ruby">        rest = m.post_match</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="50">
          <span class="hits">9</span>
          
          <code class="ruby">      return self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  # This error will be raised whenever an object could not be converted to a param string.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">  class Unconvertable &lt; StandardError</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :object</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(object)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="61">
          <span class="hits">2</span>
          
          <code class="ruby">      @object = object</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="62">
          <span class="hits">2</span>
          
          <code class="ruby">      super(&quot;Could not convert the given object (#{Object.instance_method(:inspect).bind(@object).call() rescue '&lt;????&gt;'}) to a param since it doesn't respond to :to_param or :to_s.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  # A collection of some utility methods.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  # The most methods are used to parse or generate uri-parameters.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  # I will use the escape_utils library if available, but runs happily without.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">  module Utils</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">    KCODE_UTF8 = (Regexp::KCODE_UTF8 rescue 0)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    # Bundles some string encoding methods.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">    module StringEncoding</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">      # @method to_ascii(string)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">      # converts a string to ascii</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">      # </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      # This method checks which encoding method is available.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">      # @param String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">      # @return String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">      # @visibility public</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">      def to_ascii_encode(str)</code>
        </li>
      
        <li class="covered" data-hits="488" data-linenumber="86">
          <span class="hits">488</span>
          
          <code class="ruby">        str.encode(Encoding::ASCII)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">      # @method to_utf8(string)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">      # converts a string to utf8</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">      # </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">      # This method checks which encoding method is available.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">      # @param String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">      # @return String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      # @visibility public</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">      def to_utf8_encode(str)</code>
        </li>
      
        <li class="covered" data-hits="681" data-linenumber="97">
          <span class="hits">681</span>
          
          <code class="ruby">        str.encode(Encoding::UTF_8)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">      def to_ascii_fallback(str)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="101">
          
          
          <code class="ruby">        str</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">      def to_utf8_fallback(str)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="105">
          
          
          <code class="ruby">        str</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="108">
          <span class="hits">1</span>
          
          <code class="ruby">      if &quot;&quot;.respond_to?(:encode)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">        # @private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">        alias_method :to_ascii, :to_ascii_encode</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">        # @private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">        alias_method :to_utf8, :to_utf8_encode</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">        # @private</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="115">
          
          
          <code class="ruby">        alias_method :to_ascii, :to_ascii_fallback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">        # @private</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">        alias_method :to_utf8, :to_utf8_fallback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">      public :to_ascii</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">      public :to_utf8</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">    module Escaping</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">      # A pure escaping module, which implements escaping methods in pure ruby.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">      # The performance is acceptable, but could be better with escape_utils.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">      module Pure</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">        include StringEncoding</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">        # @private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">        URL_ESCAPED = /([^A-Za-z0-9\-\._])/.freeze</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">        # @private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">        URI_ESCAPED = /([^A-Za-z0-9!$&amp;'()*+,.\/:;=?@\[\]_~])/.freeze</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">        # @private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">        PCT = /%(\h\h)/.freeze</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">        def escape_url(s)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="143">
          <span class="hits">8</span>
          
          <code class="ruby">          to_utf8(s.to_s).gsub(URL_ESCAPED){</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="144">
          <span class="hits">11</span>
          
          <code class="ruby">            '%'+$1.unpack('H2'*$1.bytesize).join('%').upcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">          }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">        def escape_uri(s)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="149">
          <span class="hits">8</span>
          
          <code class="ruby">          to_utf8(s.to_s).gsub(URI_ESCAPED){</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="150">
          <span class="hits">10</span>
          
          <code class="ruby">            '%'+$1.unpack('H2'*$1.bytesize).join('%').upcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">          }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">        def unescape_url(s)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">          to_utf8( s.to_s.gsub('+',' ').gsub(PCT){</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="156">
          <span class="hits">3</span>
          
          <code class="ruby">            $1.to_i(16).chr</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="157">
          <span class="hits">10</span>
          
          <code class="ruby">          } )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">        def unescape_uri(s)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">          to_utf8( s.to_s.gsub(PCT){</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="162">
          <span class="hits">3</span>
          
          <code class="ruby">            $1.to_i(16).chr</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="163">
          <span class="hits">10</span>
          
          <code class="ruby">          })</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="166">
          <span class="hits">1</span>
          
          <code class="ruby">        def using_escape_utils?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="167">
          
          
          <code class="ruby">          false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="172">
          <span class="hits">1</span>
          
          <code class="ruby">    if defined? EscapeUtils</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">      # A escaping module, which is backed by escape_utils.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">      # The performance is good, espacially for strings with many escaped characters.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">      module EscapeUtils</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">        include StringEncoding</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">        include ::EscapeUtils</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">        def using_escape_utils?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="183">
          <span class="hits">3</span>
          
          <code class="ruby">          true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="186">
          <span class="hits">1</span>
          
          <code class="ruby">        def escape_url(s)</code>
        </li>
      
        <li class="covered" data-hits="514" data-linenumber="187">
          <span class="hits">514</span>
          
          <code class="ruby">          super(to_utf8(s)).gsub('+','%20')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">        def escape_uri(s)</code>
        </li>
      
        <li class="covered" data-hits="131" data-linenumber="191">
          <span class="hits">131</span>
          
          <code class="ruby">          super(to_utf8(s))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">        def unescape_url(s)</code>
        </li>
      
        <li class="covered" data-hits="376" data-linenumber="195">
          <span class="hits">376</span>
          
          <code class="ruby">          super(to_ascii(s))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">        def unescape_uri(s)</code>
        </li>
      
        <li class="covered" data-hits="112" data-linenumber="199">
          <span class="hits">112</span>
          
          <code class="ruby">          super(to_ascii(s))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">    include StringEncoding</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="211">
          <span class="hits">1</span>
          
          <code class="ruby">    if Escaping.const_defined? :EscapeUtils</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">      include Escaping::EscapeUtils</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">      puts &quot;Using escape_utils.&quot; if $VERBOSE</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="214">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="215">
          
          
          <code class="ruby">      include Escaping::Pure</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="216">
          
          
          <code class="ruby">      puts &quot;Not using escape_utils.&quot; if $VERBOSE</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">    # Converts an object to a param value.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">    # Tries to call :to_param and then :to_s on that object.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">    # @raise Unconvertable if the object could not be converted.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">    # @example</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">    #   URITemplate::Utils.object_to_param(5) #=&gt; &quot;5&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">    #   o = Object.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby">    #   def o.to_param</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby">    #     &quot;42&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">    #   end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">    #   URITemplate::Utils.object_to_param(o) #=&gt; &quot;42&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">    def object_to_param(object)</code>
        </li>
      
        <li class="covered" data-hits="633" data-linenumber="230">
          <span class="hits">633</span>
          
          <code class="ruby">      if object.respond_to? :to_param</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">        object.to_param</code>
        </li>
      
        <li class="covered" data-hits="631" data-linenumber="232">
          <span class="hits">631</span>
          
          <code class="ruby">      elsif object.respond_to? :to_s</code>
        </li>
      
        <li class="covered" data-hits="630" data-linenumber="233">
          <span class="hits">630</span>
          
          <code class="ruby">        object.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="235">
          <span class="hits">1</span>
          
          <code class="ruby">        raise Unconvertable.new(object) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby">    rescue NoMethodError</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">      raise Unconvertable.new(object)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">    # Returns true when the given value is an array and it only consists of arrays with two items.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">    # This useful when using a hash is not ideal, since it doesn't allow duplicate keys.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby">    # @example</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="245">
          
          
          <code class="ruby">    #   URITemplate::Utils.pair_array?( Object.new ) #=&gt; false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="246">
          
          
          <code class="ruby">    #   URITemplate::Utils.pair_array?( [] ) #=&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">    #   URITemplate::Utils.pair_array?( [1,2,3] ) #=&gt; false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">    #   URITemplate::Utils.pair_array?( [ ['a',1],['b',2],['c',3] ] ) #=&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">    #   URITemplate::Utils.pair_array?( [ ['a',1],['b',2],['c',3],[] ] ) #=&gt; false</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="250">
          <span class="hits">1</span>
          
          <code class="ruby">    def pair_array?(a)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="251">
          <span class="hits">6</span>
          
          <code class="ruby">      return false unless a.kind_of? Array</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="252">
          <span class="hits">15</span>
          
          <code class="ruby">      return a.all?{|p| p.kind_of? Array and p.size == 2 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="253">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="254">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">    # Turns the given value into a hash if it is an array of pairs.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby">    # Otherwise it returns the value.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">    # You can test whether a value will be converted with {#pair_array?}.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby">    # @example</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="260">
          
          
          <code class="ruby">    #   URITemplate::Utils.pair_array_to_hash( 'x' ) #=&gt; 'x'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby">    #   URITemplate::Utils.pair_array_to_hash( [ ['a',1],['b',2],['c',3] ] ) #=&gt; {'a'=&gt;1,'b'=&gt;2,'c'=&gt;3}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="262">
          
          
          <code class="ruby">    #   URITemplate::Utils.pair_array_to_hash( [ ['a',1],['a',2],['a',3] ] ) #=&gt; {'a'=&gt;3}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">    # @example Carful vs. Ignorant</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">    #   URITemplate::Utils.pair_array_to_hash( [ ['a',1],'foo','bar'], false ) #=&gt; {'a'=&gt;1,'foo'=&gt;'bar'}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">    #   URITemplate::Utils.pair_array_to_hash( [ ['a',1],'foo','bar'], true ) #=&gt; [ ['a',1],'foo','bar']</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="267">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="268">
          
          
          <code class="ruby">    # @param x the value to convert</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="269">
          
          
          <code class="ruby">    # @param careful [true,false] wheter to check every array item. Use this when you expect array with subarrays which are not pairs. Setting this to false however improves runtime by ~30% even with comparetivly short arrays.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">    def pair_array_to_hash(x, careful = false )</code>
        </li>
      
        <li class="covered" data-hits="171" data-linenumber="271">
          <span class="hits">171</span>
          
          <code class="ruby">      if careful ? pair_array?(x) : (x.kind_of?(Array) and x.first.kind_of?(Array))</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="272">
          <span class="hits">16</span>
          
          <code class="ruby">        return Hash[ *x.flatten(1) ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="155" data-linenumber="274">
          <span class="hits">155</span>
          
          <code class="ruby">        return x</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="275">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="276">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="277">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="278">
          <span class="hits">1</span>
          
          <code class="ruby">    extend self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
      </div>
    </div>
  </body>
</html>
